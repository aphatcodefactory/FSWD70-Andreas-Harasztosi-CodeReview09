CREATE DATABASE cr09_andreas_harasztosi_carrental;

CREATE TABLE postCodeCity(
	postCodeID INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
	postCode INT UNSIGNED NOT NULL,
	city CHAR(25) NOT NULL
);

CREATE TABLE base(
	baseID INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
    address CHAR(35) NOT NULL,
    fk_postCodeID INT NOT NULL,
    country CHAR(15),
    FOREIGN KEY (fk_postCodeID) REFERENCES postCodeCity(postCodeID) ON DELETE RESTRICT ON UPDATE CASCADE
);

CREATE TABLE car(
	carID INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
    manufacturer CHAR(15) NOT NULL,
    model CHAR(15) NOT NULL,
    colour CHAR(20) NOT NULL,
    doors INT UNSIGNED NOT NULL,
    hp INT UNSIGNED NOT NULL,
    fuelType CHAR(15) NOT NULL,
    gearType CHAR(15) NOT NULL,
    fk_baseID INT NOT NULL,
    FOREIGN KEY (fk_baseID) REFERENCES base(baseID) ON DELETE RESTRICT ON UPDATE CASCADE
);

CREATE TABLE reservation(
	resID INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
    fk_customerID INT NOT NULL,
    forWhichDatetime DATETIME NOT NULL,
    untilWhen DATETIME,
    fk_carID INT NOT NULL,
    fk_baseID INT NOT NULL,
    fk_postCodeID INT NOT NULL,
    whenRes TIMESTAMP,
    FOREIGN KEY (fk_carID) REFERENCES car(carID) ON DELETE RESTRICT ON UPDATE CASCADE,
    FOREIGN KEY (fk_baseID) REFERENCES base(baseID) ON DELETE RESTRICT ON UPDATE CASCADE,
    FOREIGN KEY (fk_postCodeID) REFERENCES postCodeCity(postCodeID) ON DELETE RESTRICT ON UPDATE CASCADE
);

CREATE TABLE customer(
	customerID INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
    fk_resID INT,
    firstName CHAR(20) NOT NULL,
    lastName CHAR(25) NOT NULL,
    birthdate DATE NOT NULL,
    address CHAR(35) NOT NULL,
    fk_postCodeID INT NOT NULL,
    country CHAR(15),
    FOREIGN KEY (fk_resID) REFERENCES reservation(resID) ON DELETE RESTRICT ON UPDATE CASCADE,
    FOREIGN KEY (fk_postCodeID) REFERENCES postCodeCity(postCodeID) ON DELETE RESTRICT ON UPDATE CASCADE
);

ALTER TABLE reservation
	ADD FOREIGN KEY (fk_customerID) REFERENCES reservation(fk_customerID) ON DELETE RESTRICT ON UPDATE CASCADE;